<Window x:Class="NavegadorWeb.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:local="clr-namespace:NavegadorWeb"
        mc:Ignorable="d"
        Title="Navegador Web Avanzado" Height="768" Width="1366"
        MinHeight="400" MinWidth="600"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" AllowsTransparency="True"
        Background="Transparent"
        Loaded="Window_Loaded" Closing="Window_Closing"
        StateChanged="MainWindow_StateChanged">

    <Window.Resources>
        <!-- Convertidor para Visibilidad -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />

        <!-- Estilo para los botones de la barra de tÃ­tulo (minimizar, maximizar, cerrar) -->
        <Style x:Key="TitleBarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Foreground" Value="#F0F0F0"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="ToolTipService.ShowOnDisabled" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#333333"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#555555"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Estilo para el botÃ³n de cerrar de la barra de tÃ­tulo (fondo rojo en hover) -->
        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource TitleBarButtonStyle}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E81123"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#F1707A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Estilo para botones de la barra de herramientas (navegaciÃ³n, acciones) -->
        <Style x:Key="ToolbarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="ToolTipService.ShowOnDisabled" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#333333"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#555555"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Foreground" Value="#888888"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Estilo para el TextBlock de la barra de estado -->
        <Style x:Key="StatusTextStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- Estilo para las cabeceras de las pestaÃ±as -->
        <Style TargetType="{x:Type TabItem}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabItem}">
                        <Border x:Name="border" BorderBrush="Transparent" BorderThickness="0" CornerRadius="5,5,0,0" Margin="2,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ContentPresenter x:Name="contentPresenter"
                                                  ContentSource="Header"
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                  Margin="{TemplateBinding Padding}"
                                                  />
                                <Button x:Name="CloseTabButton" Grid.Column="1" Content="âœ•"
                                        Style="{StaticResource TitleBarButtonStyle}"
                                        Margin="0,0,5,0" Padding="3" Width="20" Height="20"
                                        HorizontalAlignment="Center" VerticalAlignment="Center"
                                        Visibility="Collapsed"
                                        Click="CloseTabButton_Click"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#282828"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                                <Setter TargetName="CloseTabButton" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#1A1A1A"/>
                                <Setter Property="Foreground" Value="#AAAAAA"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#333333"/>
                                <Setter TargetName="CloseTabButton" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="HeaderTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <TextBlock Text="{Binding Title}" ToolTip="{Binding SourceUrl}" FontWeight="Normal" Margin="5,0"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Padding" Value="10,5,5,5"/>
        </Style>

    </Window.Resources>

    <!-- La propiedad CornerRadius se aplica al Border principal que envuelve el Grid -->
    <Border BorderThickness="1" BorderBrush="#333333" CornerRadius="8" Background="#1A1A1A">
        <Grid x:Name="mainGrid">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Barra de TÃ­tulo -->
                <RowDefinition Height="Auto"/> <!-- Barra de Herramientas y PestaÃ±as -->
                <RowDefinition Height="*"/>    <!-- Contenido del Navegador (WebView2) -->
                <RowDefinition Height="Auto"/> <!-- Barra de Estado y Descargas -->
            </Grid.RowDefinitions>

            <!-- Barra de TÃ­tulo Personalizada -->
            <Grid Grid.Row="0" Height="30" Background="#1a1a1a" MouseLeftButtonDown="Window_Drag">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Image Source="/NavegadorWeb;component/Resources/logo.ico" Width="18" Height="18" Margin="5,0,0,0" VerticalAlignment="Center"/>
                <TextBlock x:Name="WindowTitleText" Grid.Column="1" Text="Navegador Web Avanzado" VerticalAlignment="Center" Margin="5,0,0,0" FontWeight="SemiBold" Foreground="White"/>

                <Button x:Name="MinimizeButton" Grid.Column="2" Content="ðŸ—•" Style="{StaticResource TitleBarButtonStyle}" Click="MinimizeButton_Click"/>
                <Button x:Name="MaximizeRestoreButton" Grid.Column="3" Content="â¬œ" Style="{StaticResource TitleBarButtonStyle}" Click="MaximizeRestoreButton_Click"/>
                <Button x:Name="CloseButton" Grid.Column="4" Content="âœ•" Style="{StaticResource CloseButtonStyle}" Click="CloseButton_Click"/>
            </Grid>

            <!-- Barra de Herramientas y PestaÃ±as -->
            <Grid Grid.Row="1" Background="#282828">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- PestaÃ±as -->
                    <RowDefinition Height="Auto"/> <!-- Barra de URL y Botones -->
                </Grid.RowDefinitions>

                <!-- Controles de PestaÃ±as -->
                <TabControl x:Name="BrowserTabs" Grid.Row="0" Margin="0,2,0,0" SelectionChanged="BrowserTabs_SelectionChanged"
                            BorderThickness="0" Background="Transparent" Foreground="#FFFFFF">
                    <TabControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" ToolTip="{Binding SourceUrl}">
                                <!-- Icono de candado para HTTPS (se controlarÃ¡ en code-behind) -->
                                <Image x:Name="HttpsIcon" Width="16" Height="16" Margin="0,0,5,0" VerticalAlignment="Center"
                                       Visibility="{Binding IsSecure, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Image.Source>
                                        <BitmapImage UriSource="/NavegadorWeb;component/Resources/lock_icon.png"/>
                                    </Image.Source>
                                </Image>
                                <TextBlock Text="{Binding DisplayTitle}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabControl.ItemTemplate>
                </TabControl>


                <!-- Barra de NavegaciÃ³n (URL, AtrÃ¡s/Adelante, Recargar, etc.) -->
                <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="5" VerticalAlignment="Center">
                    <Button x:Name="BackButton" Content="â—€" Style="{StaticResource ToolbarButtonStyle}" Click="BackButton_Click" IsEnabled="False" ToolTip="AtrÃ¡s"/>
                    <Button x:Name="ForwardButton" Content="â–¶" Style="{StaticResource ToolbarButtonStyle}" Click="ForwardButton_Click" IsEnabled="False" ToolTip="Adelante"/>
                    <Button x:Name="ReloadButton" Content="âŸ³" Style="{StaticResource ToolbarButtonStyle}" Click="ReloadButton_Click" ToolTip="Recargar"/>
                    <Button x:Name="StopButton" Content="âœ–" Style="{StaticResource ToolbarButtonStyle}" Click="StopButton_Click" ToolTip="Detener"/>

                    <TextBox x:Name="AddressBar" Text="about:blank" VerticalAlignment="Center" Width="Auto"
                             MinWidth="200"
                             Margin="5,0" Padding="5" FontSize="14"
                             Background="#3A3A3A" Foreground="#E0E0E0" BorderBrush="#555555" BorderThickness="1"
                             KeyUp="AddressBar_KeyUp" ToolTip="Ingresa una URL o tÃ©rmino de bÃºsqueda"/>

                    <Button x:Name="GoButton" Content="Ir" Style="{StaticResource ToolbarButtonStyle}" Click="GoButton_Click" ToolTip="Ir a la direcciÃ³n"/>

                    <!-- BotÃ³n para aÃ±adir nueva pestaÃ±a -->
                    <Button x:Name="NewTabButton" Content="âž•" Style="{StaticResource ToolbarButtonStyle}" Click="NewTabButton_Click" ToolTip="Abrir Nueva PestaÃ±a"/>

                    <!-- Nuevo botÃ³n para Buscaminas sin conexiÃ³n -->
                    <Button x:Name="MinesweeperButton" Content="ðŸ’£" Style="{StaticResource ToolbarButtonStyle}" Click="MinesweeperButton_Click" ToolTip="Jugar Buscaminas (requiere conexiÃ³n)"/>

                    <!-- MenÃº de herramientas/opciones -->
                    <Menu Background="Transparent" VerticalAlignment="Center" Margin="5,0,0,0">
                        <MenuItem Header="â‹®" Foreground="#E0E0E0" FontSize="18" FontWeight="Bold" Background="Transparent">
                            <MenuItem.Style>
                                <Style TargetType="MenuItem">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="8,5"/>
                                    <Setter Property="Margin" Value="2,0"/>
                                    <Setter Property="Foreground" Value="#E0E0E0"/>
                                    <Setter Property="FontWeight" Value="Normal"/>
                                    <Setter Property="FontSize" Value="16"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="MenuItem">
                                                <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="3">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#333333"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="#555555"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </MenuItem.Style>

                            <MenuItem Header="Modo Oscuro" Click="ToggleDarkMode_Click" Background="#3A3A3A" Foreground="#E0E0E0"/>
                            <MenuItem Header="Favoritos" Background="#3A3A3A" Foreground="#E0E0E0">
                                <MenuItem Header="AÃ±adir a Favoritos" Click="AddToFavorites_Click" Background="#3A3A3A" Foreground="#E0E0E0"/>
                                <Separator/>
                                <MenuItem x:Name="FavoritesMenu" Background="#3A3A3A" Foreground="#E0E0E0">
                                    <!-- Los favoritos se aÃ±adirÃ¡n aquÃ­ dinÃ¡micamente -->
                                </MenuItem>
                            </MenuItem>
                            <MenuItem Header="Zoom" Background="#3A3A3A" Foreground="#E0E0E0">
                                <MenuItem Header="Acercar (Ctrl + +)" Click="ZoomIn_Click" Background="#3A3A3A" Foreground="#E0E0E0"/>
                                <MenuItem Header="Alejar (Ctrl + -)" Click="ZoomOut_Click" Background="#3A3A3A" Foreground="#E0E0E0"/>
                                <MenuItem Header="Zoom al 100%" Click="ZoomReset_Click" Background="#3A3A3A" Foreground="#E0E0E0"/>
                            </MenuItem>
                            <MenuItem Header="Descargas" Click="OpenDownloadsFolder_Click" Background="#3A3A3A" Foreground="#E0E0E0"/>
                            <MenuItem Header="Nueva PestaÃ±a InPrivate" Click="NewInPrivateTab_Click" Background="#3A3A3A" Foreground="#E0E0E0"/>
                        </MenuItem>
                    </Menu>
                </StackPanel>
            </Grid>

            <!-- Contenido del Navegador (Donde se cargan las pestaÃ±as) -->
            <Grid Grid.Row="2" Margin="0">
                <!-- El contenido de las pestaÃ±as (WebView2) se insertarÃ¡ aquÃ­ dinÃ¡micamente -->
            </Grid>

            <!-- Barra de Estado e InformaciÃ³n de Descargas -->
            <StatusBar Grid.Row="3" Height="25" Background="#1a1a1a" Foreground="#AAAAAA" BorderThickness="0">
                <StatusBarItem>
                    <TextBlock x:Name="StatusBarText" Text="Listo." Style="{StaticResource StatusTextStyle}"/>
                </StatusBarItem>
                <StatusBarItem HorizontalAlignment="Right">
                    <ProgressBar x:Name="DownloadProgressBar" Width="100" Height="15" Margin="0,0,5,0"
                                 Visibility="Collapsed" Background="#555555" Foreground="#007ACC"
                                 BorderBrush="#333333" BorderThickness="1"/>
                </StatusBarItem>
                <StatusBarItem HorizontalAlignment="Right">
                    <TextBlock x:Name="DownloadStatusText" Text="" Style="{StaticResource StatusTextStyle}" Margin="0,0,10,0"/>
                </StatusBarItem>
            </StatusBar>
        </Grid>
    </Border>
</Window>
